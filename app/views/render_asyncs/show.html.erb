<h1>jQuery test</h1>

<% RenderAsync.configuration.jquery = true %>

<p>
  jQuery: <script>document.write(window.jQuery)</script>
</p>


<br>
<b>Wave:</b>
<%= render_async wave_render_async_path,
                 container_id: 'ay',
                 container_class: 'ayay' do %>
  ...Loading <%= wave_render_async_path %>
<% end %>

<br>
<b>Bump:</b>
<%= render_async bump_render_async_path,
                 method: 'POST',
                 data: { fresh: 'AF' },
                 headers: { 'Content-Type': 'text' },
                 interval: 2000,
                 start_poll_on_page_load: true,
                 start_poll_event_name: 'start-right-there',
                 stop_poll_event_name: 'stop-right-there' do %>
  ...Loading <%= bump_render_async_path %>
<% end %>

<button id='stop-poll'>Stop poll</button>
<button id='start-poll'>Start poll</button>
<script>
  var stopPollElement = document.getElementById('stop-poll')
  stopPollElement.addEventListener('click', function() {
    var event = new Event('stop-right-there')
    document.dispatchEvent(event)
  })

  var startPollElement = document.getElementById('start-poll')
  startPollElement.addEventListener('click', function() {
    var event = new Event('start-right-there')
    document.dispatchEvent(event)
  })
</script>


<br>
<b>Event dispatching:</b>

<script>
  document.addEventListener('ay', function() {
    var p = document.getElementById('event-paragraph');
    p.innerHTML = 'Event dispatched!';
  });
</script>

<%= render_async wave_render_async_path, event_name: 'ay' do %>
  ...Loading <%= wave_render_async_path %>
<% end %>
<p id="event-paragraph"></p>


<br>
<b>Error message:</b>

<script>
  document.addEventListener('error-event', function() {
    var p = document.getElementById('error-event-paragraph');
    p.innerHTML = 'Error event dispatched!';
  });
</script>

<%= render_async error_render_async_path,
                 error_message: '<p>Sorry for the error :(</p>',
                 error_event_name: 'error-event' do %>
  ...Loading <%= error_render_async_path %>
<% end %>
<p id="error-event-paragraph"></p>

<br>
<b>Nested partial:</b>

<%= render_async nested_render_async_path do %>
  ...Loading <%= nested_render_async_path %>
<% end %>
